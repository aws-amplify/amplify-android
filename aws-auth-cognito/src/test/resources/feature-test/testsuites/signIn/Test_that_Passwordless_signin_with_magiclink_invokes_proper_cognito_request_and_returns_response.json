{
  "description": "Test that Passwordless signIn with magiclink invokes proper cognito request and returns custom challenge",
  "preConditions": {
    "amplify-configuration": "authconfiguration.json",
    "state": "SignedOut_Configured.json",
    "mockedResponses": [
      {
        "type": "cognitoIdentityProvider",
        "apiName": "initiateAuth",
        "responseType": "success",
        "response": {
          "challengeName": "CUSTOM_CHALLENGE",
          "challengeParameters": {
            "nextStep": "PROVIDE_AUTH_PARAMETERS"
          }
        }
      },
      {
        "type": "cognitoIdentityProvider",
        "apiName": "respondToAuthChallenge",
        "responseType": "success",
        "response": {
          "session": "someSession",
          "challengeName": "CUSTOM_CHALLENGE",
          "challengeParameters": {
            "nextStep": "PROVIDE_CHALLENGE_RESPONSE"
          }
        }
      }
    ]
  },
  "api": {
    "name": "signInWithMagicLink",
    "params": {
      "username": "username",
      "flow": "SIGN_IN",
      "redirectURL": "localhost:8080/##code##"
    },
    "options": {
      "signInOptions": {
        "authFlow": "CUSTOM_AUTH_WITHOUT_SRP"
      }
    }
  },
  "validations": [
    {
      "type": "amplify",
      "apiName": "signIn",
      "responseType": "success",
      "response": {
        "isSignedIn": false,
        "nextStep": {
          "signInStep": "CONFIRM_SIGN_IN_WITH_MAGIC_LINK",
          "additionalInfo": {
            "nextStep": "PROVIDE_CHALLENGE_RESPONSE"
          }
        }
      }
    },
    {
      "type": "state",
      "expectedState": "PasswordlessSignIn_SigningIn.json"
    }
  ]
}